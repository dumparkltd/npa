// react
var React         = require('react')
var Fluxxor      = require('fluxxor')

//components
//var SelectTaxonomy = require('components/nav/select-taxonomy')

//bootstrap
var Grid 				= require('react-bootstrap/lib/Grid')
var Row 				= require('react-bootstrap/lib/Row')
var Col 				= require('react-bootstrap/lib/Col')

//helpers
var _         = require('lodash')
var log       = require('debug')('src:components:nav-primary')


module.exports = React.createClass({
  mixins: [
    Fluxxor.FluxMixin(React)
  ],
  isActive : function(navItem){
    var flux = this.getFlux()
    var route = flux.stores.routes.getCurrentRoute()
    var slug = flux.stores.routes.getCurrentParams().id
    return navItem.route === route
      && (typeof navItem.slug !== 'undefined' ? navItem.slug === slug : true )
  },
  render: function () {
    log('props', this.props)
    var flux = this.getFlux();
    var navItems = [
      {slug:'issues',route:'explore-by',title:'Explore by Category', title_short:'Category'},
      {slug:'actions',route:'all',title:'All Actions', title_short:'Actions'},
      {slug:'recommendations',route:'all',title:'All Recommendations', title_short:'Recommendations'},
      {route:'search',title:'Search', title_short:'', icon:'icon-magnifier'}
    ]

    return (
      <nav className='nav-primary'>
        <Grid className=''>
          <div className='nav-primary-group'>
            {
              _.map(navItems, function(navItem) {
                return (
                  <a
                    role="button"
                    aria-selected={this.isActive(navItem)}
                    title={navItem.title}
                    className={'btn' + (this.isActive(navItem) ? ' active' : '')}
                    href='#'
                    onClick={this.handleItemClick(navItem)}
                  >
                    {this.getTitle(navItem)}        
                  </a>
                )
              },this)
            }
          </div>
        </Grid>
      </nav>
    )
  },
  getTitle : function (navItem) {
    return (
      <div className='title'>
        <span className='hidden-xs'>{navItem.title}</span>
        <span className='visible-xs'>{navItem.title_short}</span>
        {navItem.icon ? (<span className={navItem.icon}/>) : null}
      </div>
    )
  },
  handleItemClick: function (item) {
    return _.bind(function (e) {
      e.preventDefault()
      this.getFlux().actions.navigate(item.route,item.slug)
    },this)
  }
})
