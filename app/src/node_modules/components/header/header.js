//react
var React       = require('react')
var Fluxxor     = require('fluxxor')

// components
var ShareModal      = require('components/share-modal')
var Navbar          = require('components/nav/nav-main')

// bootstrap
var Grid            = require('react-bootstrap/lib/Grid')



//helpers
var _           = require('lodash')
var log         = require('debug')('components:header')

module.exports = React.createClass({

  mixins: [
    Fluxxor.FluxMixin(React)
  ],
  propTypes: {
    currentHREF : React.PropTypes.string,
    route       : React.PropTypes.string,
    param       : React.PropTypes.string,
    title       : React.PropTypes.string,
    subtitle    : React.PropTypes.string
  },

  getInitialState: function () {
    return {
      hideShareModal: true
    }
  },
    
  render: function () {
    log('props', this.props, window.location)

    var tweet = "Check out what NZ is doing to improve human rights"
    var title = "NZ Human Rights National Plan of Action"
    var rootURI = window.location.protocol+'//'+window.location.host+'/'
    var encodedRootURI = encodeURIComponent(rootURI)
    var facebookShare = "https://www.facebook.com/sharer/sharer.php?u=" + encodedRootURI
    var twitterShare = "https://twitter.com/intent/tweet?status=" + encodeURIComponent(tweet) + " " + encodedRootURI + " " + encodeURIComponent("@NZHumanRights") 
    var linkedinShare = "https://www.linkedin.com/shareArticle?mini=true&url=" + encodedRootURI + "&title=" + encodeURIComponent(title)            
    
    var headerClass = this.isIntro() ? 'hrc-header header-intro' : 'hrc-header'



    return (
        <div className={headerClass}>
          <Navbar
            route =           {this.props.route}
            param =           {this.props.param}
            brand =           {this.renderBrand()}
            isIntro =         {this.isIntro()}
            facebookShare =   {facebookShare}
            twitterShare =    {twitterShare}
            linkedinShare =   {linkedinShare}
            handleNavClick =  {this.handleNavClick}
            toggleShareModal ={this.toggleShareModal}
          />
          <ShareModal
            currentHREF=      {this.props.currentHREF}
            shouldHide=       {this.state.hideShareModal}
            facebookShare =   {facebookShare}
            twitterShare =    {twitterShare}
            linkedinShare =   {linkedinShare}
            toggleShareModal= {this.toggleShareModal} 
          />
        </div>

    )
  },
  renderBrand : function() {
    return (
      <div role="banner">
        <div key={0} className='header-logo'>
          <a title="NPA home" className="icon-hrc-logo-sm" onClick={this.handleNavClick('home')} href='#'></a>
        </div>
        <div key={1} className='header-brand-title'>
          <a title="NPA home" className='hrc-title-link' onClick={this.handleNavClick('home')} href='#' >
            <h1 className="hrc-title">{this.props.title}</h1>
            <div className="hrc-subtitle">{this.props.subtitle}</div>
          </a>
        </div>
      </div>
    )
  },
  isIntro : function(){
    return this.props.route === 'intro'
  },
  handleNavClick: function (page) {
    var flux = this.getFlux()

    return function (e) {
      e.preventDefault()
      flux.actions.navPage(page)
    }
  }, 

  toggleShareModal: function () {
    var self = this
    return function (e) {
      e.preventDefault()
      self.setState({ hideShareModal: !self.state.hideShareModal })
    }
  }
  

})
