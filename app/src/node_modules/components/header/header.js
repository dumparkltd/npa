//main
var React       = require('react')

//helpers
var _           = require('lodash')

var Grid            = require('react-bootstrap/lib/Grid')
var Nav             = require('react-bootstrap/lib/Nav')
var Navbar          = require('react-bootstrap/lib/Navbar')
var NavItem         = require('react-bootstrap/lib/NavItem')
var CollapsibleNav  = require('react-bootstrap/lib/CollapsibleNav')
var ShareModal      = require('components/share-modal')


//logging
var log         = require('debug')('components:header')

module.exports = React.createClass({

  propTypes: {
    currentHREF : React.PropTypes.string,
    route       : React.PropTypes.string,
    title       : React.PropTypes.string,
    subtitle    : React.PropTypes.string,
    flux        : React.PropTypes.object,
  },

  getInitialState: function () {
    return {
      hideShareModal: true
    }
  },

  render: function () {
    log('props', this.props, window.location)

    var Brand = ([
      <div key={0} className='header-logo'>
        <a className="icon-hrc-logo-sm " href="http://hrc.co.nz" target="_blank"></a>
      </div>,
      <div key={1} className='header-brand-title'>
        <a className='hrc-title-link' onClick={this.handleNavClick('home')} href='#' >
          <h1 className="hrc-title">{this.props.title}</h1>
          <div className="hrc-subtitle">{this.props.subtitle}</div>
        </a>
      </div>
    ])

    var Title = (
      (this.isIntro()) ? null :
        <a className='hrc-title-item' onClick={this.handleNavClick('home')} >
          <h1 className="hrc-title">{this.props.title}</h1>
          <div className="hrc-subtitle">{this.props.subtitle}</div>
        </a>
    )
      
      
    var shareClass =  'nav-item-share'
    var tweet = "Check out what NZ is doing to improve human rights"
    var title = "NZ Human Rights National Plan of Action"
    var rootURI = window.location.protocol+'//'+window.location.host+'/'
    var encodedRootURI = encodeURIComponent(rootURI)
    var facebookShare = "https://www.facebook.com/sharer/sharer.php?u=" + encodedRootURI
    var twitterShare = "https://twitter.com/intent/tweet?status=" + encodeURIComponent(tweet) + " " + encodedRootURI + " " + encodeURIComponent("@NZHumanRights") 
    var linkedinShare = "https://www.linkedin.com/shareArticle?mini=true&url=" + encodedRootURI + "&title=" + encodeURIComponent(title)
    
    var RightNav = (this.isIntro()) ? 
      null
     : [
      <Nav key={0} className="nav-group nav-group-share hidden-xs" navbar right>
        <NavItem eventKey={1} href={facebookShare} className="share-header-social share-header-social-facebook"  target="_blank">
          <div className="icon-social-facebook-sm"/>
        </NavItem>
        <NavItem eventKey={2} href={twitterShare} className="share-header-social share-header-social-twitter"  target="_blank">
          <div className="icon-social-twitter-sm"/>
        </NavItem>
        <NavItem eventKey={3} href='#' className={shareClass} onClick={this.toggleShareModal()} >
          <span className="icon-social-share"/>
          Share
        </NavItem>
      </Nav>,
      <Nav key={1} className="nav-group nav-group-pages" navbar right>
        <NavItem eventKey={1} href='#' className={'nav-item-about'} onClick={this.handleNavClick('about')}>
          About
        </NavItem>
        <NavItem eventKey={2} href='#' className={'nav-item-articles'} onClick={this.handleNavClick('articles')}>
          Human Rights Articles
        </NavItem>
        <NavItem eventKey={3} href='#' className={'nav-item-terms'} onClick={this.handleNavClick('terms')}>
          Terms
        </NavItem>
      </Nav>,
      <Nav key={2} className="nav-group nav-group-share visible-xs" navbar right>
        <NavItem eventKey={1} href={facebookShare} className="share-header-social share-header-social-facebook"  target="_blank">
          <div className="icon-social-facebook-sm"/>
        </NavItem>
        <NavItem eventKey={2} href={twitterShare} className="share-header-social share-header-social-twitter"  target="_blank">
          <div className="icon-social-twitter-sm"/>
        </NavItem>
        <NavItem eventKey={3} href='#' className={shareClass} onClick={this.toggleShareModal()} >
          <span className="icon-social-share"/>
          Share
        </NavItem>
      </Nav>         
     ]
    
    var headerClass = this.isIntro() ? 'header-intro navbar-tew-wrapper' : 'navbar-tew-wrapper'



    return (
        <div className={headerClass}>
          <Navbar className='navbar-tew' brand={Brand}  toggleNavKey={0} defaultNavExpanded={false}>
            <CollapsibleNav eventKey={0}>
              { RightNav }      
            </CollapsibleNav>
          </Navbar>
          <ShareModal
            currentHREF={this.props.currentHREF}
            shouldHide={this.state.hideShareModal}
            facebookShare = {facebookShare}
            twitterShare = {twitterShare}
            linkedinShare = {linkedinShare}
            toggleShareModal={this.toggleShareModal} />
        </div>

    )
  },
          
  isIntro : function(){
    return this.props.route === 'intro'
  },
  
  handleNavClick: function (page) {
    var flux = this.props.flux

    return function (e) {
      e.preventDefault()
      flux.actions.navPage(page)
    }
  },

  toggleShareModal: function () {
    log('init')
    var self = this
    return function (e) {
      e.preventDefault()
      self.setState({ hideShareModal: !self.state.hideShareModal })
    }
  }
})
