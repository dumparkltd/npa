module.exports = function (url, onSuccess, onError) {
  var datauri, canvas, ctx
  var img = new Image()
  img.onload = function () {
    // Create the canvas element.
    canvas = document.createElement('canvas')
    canvas.width = img.width
    canvas.height = img.height
    // Get '2d' context and draw the image.
    ctx = canvas.getContext('2d')
    ctx.drawImage(img, 0, 0)
    // Get canvas data URL
    try {
      datauri = canvas.toDataURL()
      onSuccess(datauri)
    } catch (e) {
      onError({error:true,message:'Failed to load image ' + url, e:e})
    }
  }
  img.onerror = function(e){
    onError({error:true,message:'Failed to load image ' + url, e:e})
  }
  // Load image URL.
  try {
    img.src = url
  } catch (e) {
    onError({error:true,message:'Failed to load image ' + url, e:e})
  }
}