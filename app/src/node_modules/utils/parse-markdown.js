var marked = require('marked')

// cribbed from https://github.com/chjj/marked/pull/451#issuecomment-49976076
var myRenderer = new marked.Renderer();
myRenderer.image = function(href, title, text) {  
  // href = "img/hrcnz-UPR-cycle.png", title = null, text = "The UPR Process"  
  var hiddenXS = '<img class="hidden-xs img-responsive" src="'+href+'" alt="'+text+'">'
  var visibleXS = '<a class="visible-xs" href="'+href+'" target="_blank" title="Open full size image in new tab">\n\
      <img class="img-responsive" src="'+href+'" alt="'+text+'">\n\
    </a>'
  return hiddenXS + visibleXS  
};
myRenderer.link = function(href, title, text) {
  var external, newWindow, out;
  external = /^https?:\/\/.+$/.test(href);
  newWindow = external || title === 'newWindow';
  out = "<a href=\"" + href + "\"";
  if (newWindow) {
    out += ' target="_blank"';
  }
  if (title && title !== 'newWindow') {
    out += " title=\"" + title + "\"";
  }
  return out += ">" + text + "</a>";
};

marked.setOptions({renderer: myRenderer});

module.exports = marked
